# Tello Laser Shot

Высокоурвневый интерфейс управления для дрона DJI Tello EDU, написаный для применения в качестве исходной архитектуры для решения кейса __«Разработка системы управления для автономного ударного беспилотного летательного аппарата»__ на форуме __«ПроеКТОриЯ 2019»__ в г.Ярославль 23.11.19 — 25.11.19.

## Содержание
- [Условия кейса](#условия-кейса)
- [Демонстрация решения](#демонстрация-решения)
- [Установка](#установка)
- [Описание файлов в репозитории](#описание-файлов-в-репозитории)
- [Архитектура системы управления](#архитектура-системы-управления)
	- [Структурная схема](#структурная-схема)
	- [Реализованная часть](#реализованная-часть)
	- [Особенности управления](#особенности-управления)
- [Contributing](#contributing)
- [Авторы](#авторы)


## Условия кейса

[Постановка инженерно-технической задачи кейса](https://github.com/Keleas/Tello_Laser_Shot/blob/master/case_conditions.md), которая включает в себя цели, задачи, принятые ограничения и характеристики объектов кейса.

[Презентация](https://docs.google.com/presentation/d/15SAW8LknzE6YfrhGR5P2_PucGrpDgtmB-_SrqSMS_jw/edit?usp=sharing) с защиты кейса.

## Демонстрация решения

*В процессе разработки ...*

## Установка

### PIP

Чтобы установить окружение с помощью __pip__:


1. Установить окружение ``` python3 -m venv tello_drone ```

2. Активировать окружение: 
	- Windows: ``` tello_drone\Scripts\activate.bat ```

	- Unix или MacOS: ``` source tello_drone/bin/activate ```

3. Установить необходимые пакеты: ``` pip3 install -r requirements.txt ```

### Conda

Чтобы установить окружение с помощью __conda__:

1. Установить окружение: ```conda create -n tello_drone python=3```

2. Активировать окружение: ``` conda activate tello_drone ```

3. Установить необходимые пакеты: ``` conda install --yes --file requirements.txt ```

## Описание файлов в репозитории

 - __drone/main.py__ — Главный исполняемый файл, запускающий весь цикл работы дрона или отладочной системы.

- __drone/tools.py__ — Инструменты для передачи информации между модулями, инициализация вспомогательных классов.

- __drone/cv_system.py__ — Система технического зрения.

- __drone/controller.py__ — Обвязка системы управления дрона.

- __drone/djitellopy__ — [DJI Tello](https://github.com/damiafuentes/DJITelloPy) Python интерфейс с использованием официального Tello SDK.

- __useful/laser.py__ — Пример управления модулем полезной нагрузки.

- __useful/cv_algo.py__ — Шаблоны для обработки видеопотока и определения цвета.

*Код обновляется ...*

## Архитектура системы управления

Ниже представлено описание решения по разработке системы управления автономного БПЛА с полезной нагрузкой в виде системы лазерной подсветки целей (мишеней).

### Структурная схема

Комплексную систему управления БПЛА предлагается разбить на ряд подсистем (модулей):
- технического зрения;
- прицеливания;
- управления полезной нагрузкой;
- БПЛА–вождения;
- диспетчера.

Структурная схема взаимодействия всех модулей описана на рисунке ниже:

<img src="https://i.ibb.co/RpNnSfq/fig.png" width=80%>

### Реализованная часть

*Изначально участникам кейса предоставляется интерфейс системы управления с инициализированными модулями и архитектурой.*

__Готово:__
- [x] __Модуль диспетчера для обмена сообщенями управления и проверки состояний с дроном__
- [x] __Модуль ручного управления с возможностью выбора типа системы управления: 1-го или 4-ех канального__
- [ ] __Модуль пересчета сигналов управления в физические величины__
- [ ] __Модуль технического зрения__
	- [ ] Система прицеливания
	- [ ] Система выбора оптимальной цели
- [ ] __Модуль автопилота__
	- [ ] Система выбора оптимальной стратегии поведения
	- [ ] Система построения маршрута движения
	- [ ] Система наведения
- [ ] __Модуль управления полезной нагрузкой__
	- [ ] Система ведения огня
	- [ ] Система выбора оптимальной стратегии ведения огня

*Код обновляется ...*

### Особенности управления

Управление дроном происходит за счет обмена закодированных сообщений по протоколу UDP, не имющего обратной связи. Однако реализация передачи сообщений включает проверку получения обратного сигнала от дрона после выполнения заданной ему команды. 

Движение дрона осуществлятся с помощью 1-го или 4-ех канального управления. Ограничения первого типа управления состоят в невозможности обмена сообщенями во время выполнения команд движения, команды движения ограничены и строго дискретизированы по каждому направлению. Из-за этих недостатков применение такого типа управления в режиме автопилота считается невозможным.

Преимущество 4-ех канальной передачи команд управления состоит в возможности изменения направления двжиения по нескольким атомарным командам: 
- движение вперед/назад;
- поворот налево/направо;
- движение вверх/вниз;
- двжиение влево/вправо.

Все команды и допустимые значения сигналов указаны в [Tello EDU SDK](https://dl-cdn.ryzerobotics.com/downloads/Tello/Tello%20SDK%202.0%20User%20Guide.pdf).

__Команды ручного управления:__

- "w"/"s" — движение вперед/назад
- "a"/"d" — поворот налево/направо
- "q"/"e" — движение вверх/вниз
- "z"/"c" — движение влево/вправо
- "t" — взлет
- "l" — посадка
- "m" — переключение типа рученого управления
- "p" — включение/выключение автопилота
- "1" - 5" — переключение передачи скорости 

## Contributing 

Правила внесения изменений в репозиторий для коллективной работы над кейсом:

1. Сделать ```fork``` репозитория

2. Склонировать на локальное устройство

3. Внести изменения

4. Сделать ```pull request```

## Авторы

__Кураторы кейса:__

[Nikita Grishin](https://github.com/Keleas)

[Daniil Makhotkin](https://github.com/Ken-chan)

__Участники кейса:__

*Список пополняется ...*
